<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Nearest Neighbors (KNN) åˆ†é¡æ¼”ç®—æ³• - æ­¥é©Ÿå¼è¦–è¦ºåŒ–æ•™å­¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 90%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 15px;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 5px;
            font-size: 1.8em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
            align-items: start;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .steps-panel {
                position: relative;
                top: 0;
                max-height: none;
            }
        }

        .canvas-section {
            display: flex;
            flex-direction: column;
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
        }

        .canvas-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }

        canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: crosshair;
            display: block;
            margin: 0 auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            width: 100%;
            height: auto;
            box-sizing: border-box;
        }

        .controls {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #dee2e6;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
            padding-right: 20px;
            border-right: 2px solid #dee2e6;
        }

        .control-group label {
            font-weight: 700;
            color: #495057;
            white-space: nowrap;
            font-size: 0.95em;
            letter-spacing: 0.3px;
        }

        select {
            padding: 8px 16px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            background: white;
            color: #212529;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
            min-width: 80px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        select:hover {
            border-color: #667eea;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.2);
        }

        select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }

        .info-inline {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: nowrap;
            flex: 1;
            justify-content: space-between;
            padding-left: 20px;
        }

        .info-item-inline {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px 18px;
            border-radius: 10px;
            color: white;
            font-size: 0.9em;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: fit-content;
        }

        .info-item-inline .info-label {
            opacity: 0.95;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .info-item-inline .info-value {
            font-weight: 700;
            font-size: 1.15em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .info-item-inline.prediction {
            background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%);
            padding: 12px 20px;
            font-size: 0.95em;
        }

        .info-item-inline.prediction .info-value {
            font-size: 1.2em;
        }

        .instruction-text {
            background: #e8f0fe;
            border-left: 4px solid #1a73e8;
            border-radius: 5px;
            padding: 8px 12px;
            margin-bottom: 12px;
            color: #1a73e8;
            font-size: 0.85em;
            font-weight: 500;
        }

        button {
            padding: 10px 24px;
            background: linear-gradient(135deg, #667eea 0%, #5568d3 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            white-space: nowrap;
            flex-shrink: 0;
            letter-spacing: 0.3px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .info-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            padding: 12px;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 12px;
        }

        .info-panel h2 {
            margin-bottom: 12px;
            font-size: 1.2em;
            text-align: center;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .info-label {
            font-size: 0.8em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.2em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .steps-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            position: sticky;
            top: 15px;
            max-height: calc(100vh - 30px);
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
            min-width: 0;
        }

        .steps-panel h2 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .step {
            background: white;
            border-left: 4px solid #667eea;
            border-radius: 5px;
            padding: 8px;
            margin-bottom: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .step.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step.clickable:hover {
            background: #f0f4ff;
            transform: translateX(3px);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.2);
        }

        .step-control {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #dee2e6;
        }

        .step-control .control-group {
            border: none;
            padding: 0;
        }

        .step-info {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #dee2e6;
        }

        .step-instruction {
            color: #dc3545;
            font-weight: 600;
            margin-top: 8px;
            font-size: 0.9em;
        }

        .step-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 6px 0;
            padding: 6px 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            color: white;
            font-size: 0.85em;
        }

        .step-info-item .info-label {
            opacity: 0.95;
            font-weight: 600;
        }

        .step-info-item .info-value {
            font-weight: 700;
            font-size: 1.1em;
        }

        .step-info-item.prediction {
            background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%);
            padding: 8px 12px;
        }

        .step-distance-list {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #dee2e6;
            max-height: 300px;
            overflow-y: auto;
        }

        .step-distance-list-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .step-distance-item {
            padding: 6px 10px;
            margin: 4px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            color: white;
            font-size: 0.8em;
            font-family: 'Courier New', monospace;
        }

        .step-distance-item.highlight {
            background: linear-gradient(135deg, #a8c5f0 0%, #b8d0f5 100%);
            color: #333;
            font-weight: 600;
        }

        .step.active {
            background: #e8f0fe;
            border-left-color: #1a73e8;
            box-shadow: 0 4px 10px rgba(26, 115, 232, 0.2);
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            font-size: 0.85em;
            margin-right: 8px;
        }

        .step.active .step-number {
            background: #1a73e8;
        }

        .step-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .step-description {
            color: #666;
            font-size: 0.75em;
            line-height: 1.4;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
            font-size: 0.85em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }

        .legend-color.square {
            border-radius: 0;
        }

        .legend-color.star {
            background: #22c55e;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }

        .distance-list {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 8px;
            font-size: 0.75em;
        }

        .distance-item {
            padding: 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .distance-item.highlight {
            background: rgba(255, 255, 255, 0.3);
            font-weight: bold;
        }

        .prerequisites-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
            border-left: 5px solid #ffc107;
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .prerequisites-box h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prerequisites-box ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .prerequisites-box li {
            color: #856404;
            padding: 6px 0;
            padding-left: 25px;
            position: relative;
            line-height: 1.5;
            font-size: 0.85em;
        }

        .prerequisites-box li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
            font-size: 1.2em;
        }

        .prerequisites-box strong {
            color: #856404;
            font-weight: 700;
        }

        .data-example {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 5px;
            padding: 10px;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            border-left: 3px solid #ffc107;
        }

        .data-example code {
            color: #856404;
            font-weight: bold;
        }

        .data-explanation {
            margin-top: 8px;
            padding-left: 15px;
            font-size: 0.8em;
            line-height: 1.6;
        }

        .data-explanation .feature {
            color: #856404;
            margin: 4px 0;
        }

        .data-format-explanation {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed #dee2e6;
        }

        .data-example-code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }

        .data-example-code code {
            color: #495057;
            font-size: 0.9em;
            font-weight: 600;
        }

        .data-explanation-list {
            margin-bottom: 12px;
        }

        .data-feature-item {
            padding: 6px 0;
            color: #495057;
            font-size: 0.85em;
            line-height: 1.5;
        }

        .data-feature-item strong {
            color: #1a73e8;
            font-weight: 600;
        }

        .download-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed #dee2e6;
        }

        .download-btn {
            width: 100%;
            padding: 10px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .download-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ K-Nearest Neighbors (KNN) åˆ†é¡æ¼”ç®—æ³•</h1>
        <p class="subtitle">äº’å‹•å¼æ­¥é©Ÿè¦–è¦ºåŒ–æ•™å­¸ - ç†è§£æ©Ÿå™¨å­¸ç¿’åˆ†é¡æ¼”ç®—æ³•</p>

        <div class="prerequisites-box">
            <h3>ğŸ“‹ é‡è¦å‰æèªªæ˜</h3>
            <ul>
                <li>
                    <strong>KNN æ˜¯ç›£ç£å¼å­¸ç¿’æ¼”ç®—æ³•ï¼š</strong>
                    K-Nearest Neighbors å±¬æ–¼ç›£ç£å¼å­¸ç¿’ï¼ˆSupervised Learningï¼‰ï¼Œé€™æ„å‘³è‘—æ¼”ç®—æ³•éœ€è¦å¾å·²æ¨™è¨˜çš„è¨“ç·´è³‡æ–™ä¸­å­¸ç¿’æ¨¡å¼ï¼Œç„¶å¾Œå°æ–°çš„æœªæ¨™è¨˜è³‡æ–™é€²è¡Œåˆ†é¡é æ¸¬ã€‚
                </li>
                <li>
                    <strong>è¨“ç·´è³‡æ–™å·²åŒ…å«æ­£ç¢ºçš„é¡åˆ¥æ¨™ç±¤ï¼š</strong>
                    ç•«å¸ƒä¸Šçš„è—è‰²åœ“å½¢å’Œç´…è‰²æ–¹å½¢ä»£è¡¨è¨“ç·´è³‡æ–™é»ï¼Œé€™äº›é»å·²ç¶“è¢«æ­£ç¢ºæ¨™è¨˜ç‚ºã€Œé¡åˆ¥ Aã€ï¼ˆè—è‰²ï¼‰æˆ–ã€Œé¡åˆ¥ Bã€ï¼ˆç´…è‰²ï¼‰ã€‚é€™äº›æ¨™ç±¤ï¼ˆlabelï¼‰æ˜¯ KNN æ¼”ç®—æ³•é€²è¡Œåˆ†é¡çš„åŸºç¤ï¼Œæ¼”ç®—æ³•æœƒæ ¹æ“šé€™äº›å·²çŸ¥æ¨™ç±¤ä¾†é æ¸¬æ–°æ¸¬è©¦é»çš„é¡åˆ¥ã€‚
                </li>
            </ul>
        </div>

        <div class="main-content">
            <!-- å·¦å´ï¼šæ­¥é©Ÿèªªæ˜ -->
            <div class="steps-panel">
                <h2>ğŸ“š KNN æ¼”ç®—æ³•æ­¥é©Ÿèªªæ˜</h2>
            <div class="step clickable" id="step-1">
                <span class="step-number">1</span>
                <span class="step-title">åˆå§‹åŒ–è¨“ç·´è³‡æ–™</span>
                <div class="step-description">
                    åœ¨ 800Ã—600 åƒç´ çš„ç•«å¸ƒä¸Šéš¨æ©Ÿç”Ÿæˆ 50 å€‹è¨“ç·´è³‡æ–™é»ï¼Œåˆ†ç‚ºå…©é¡ï¼š
                    è—è‰²åœ“å½¢ä»£è¡¨ã€Œé¡åˆ¥ Aã€ï¼Œç´…è‰²æ–¹å½¢ä»£è¡¨ã€Œé¡åˆ¥ Bã€ã€‚
                    è³‡æ–™é»ç•¥æœ‰åˆ†ä½ˆé‡ç–Šï¼Œä»¥å‰µé€ æœ‰è¶£çš„æ±ºç­–é‚Šç•Œã€‚
                </div>
                <div class="download-section">
                    <button id="downloadDataBtn" class="download-btn" type="button">
                        ğŸ“„ æŸ¥çœ‹è¨“ç·´è³‡æ–™ç¯„ä¾‹ (JSON)
                    </button>
                </div>
            </div>
            <div class="step" id="step-2">
                <span class="step-number">2</span>
                <span class="step-title">è¨­å®š K å€¼åƒæ•¸</span>
                <div class="step-description">
                    ä½¿ç”¨ä¸‹æ‹‰é¸å–®é¸æ“‡ K å€¼ï¼ˆç¯„åœï¼š1-12ï¼Œé è¨­ç‚º 3ï¼‰ã€‚
                    K å€¼æ±ºå®šäº†è¦è€ƒæ…®å¤šå°‘å€‹æœ€è¿‘é„°å±…ä¾†é€²è¡Œåˆ†é¡ã€‚
                </div>
                <div class="step-control">
                    <div class="control-group">
                        <label for="kSelect">K å€¼ï¼š</label>
                        <select id="kSelect">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3" selected>3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="step" id="step-3">
                <span class="step-number">3</span>
                <span class="step-title">æ”¾ç½®æ¸¬è©¦é»</span>
                <div class="step-description">
                    é»æ“Šç•«å¸ƒä¸Šçš„ä»»æ„ä½ç½®ä¾†æ”¾ç½®ä¸€å€‹æ¸¬è©¦é»ï¼ˆæ˜Ÿè™Ÿï¼‰ã€‚
                    é€™å€‹é»å°±æ˜¯æˆ‘å€‘è¦åˆ†é¡çš„æ–°è³‡æ–™é»ã€‚
                </div>
                <div class="step-instruction">
                    é»æ“Šç•«é¢ï¼Œå³å¯æ”¾ç½®æ¸¬è©¦é»ã€‚
                </div>
            </div>
            <div class="step" id="step-4">
                <span class="step-number">4</span>
                <span class="step-title">è¨ˆç®—æ­å¹¾é‡Œå¾—è·é›¢</span>
                <div class="step-description">
                    è¨ˆç®—æ¸¬è©¦é»èˆ‡æ‰€æœ‰ 50 å€‹è¨“ç·´è³‡æ–™é»ä¹‹é–“çš„æ­å¹¾é‡Œå¾—è·é›¢ã€‚
                    è·é›¢å…¬å¼ï¼šâˆš[(xâ‚-xâ‚‚)Â² + (yâ‚-yâ‚‚)Â²]
                </div>
                <div class="step-distance-list" id="step-distance-list" style="display: none;">
                    <div class="step-distance-list-title">K å€‹æœ€è¿‘é„°å±…è·é›¢ï¼š</div>
                    <div id="step-distance-items"></div>
                </div>
            </div>
            <div class="step" id="step-5">
                <span class="step-number">5</span>
                <span class="step-title">é¸å– K å€‹æœ€è¿‘é„°å±…</span>
                <div class="step-description">
                    æ ¹æ“šè¨ˆç®—å‡ºçš„è·é›¢ï¼Œé¸å‡ºè·é›¢æœ€è¿‘çš„ K å€‹è¨“ç·´è³‡æ–™é»ã€‚
                    é€™äº›é»å°±æ˜¯åƒèˆ‡æŠ•ç¥¨çš„ã€Œé„°å±…ã€ã€‚
                </div>
            </div>
            <div class="step" id="step-6">
                <span class="step-number">6</span>
                <span class="step-title">ç¹ªè£½é€£æ¥ç·š</span>
                <div class="step-description">
                    ç”¨è™›ç·šå°‡æ¸¬è©¦é»é€£æ¥åˆ°é€™ K å€‹æœ€è¿‘é„°å±…ï¼Œ
                    è®“ä½¿ç”¨è€…æ¸…æ¥šçœ‹åˆ°å“ªäº›é»åƒèˆ‡äº†åˆ†é¡æ±ºç­–ã€‚
                </div>
            </div>
            <div class="step" id="step-7">
                <span class="step-number">7</span>
                <span class="step-title">å¤šæ•¸æŠ•ç¥¨</span>
                <div class="step-description">
                    çµ±è¨ˆé€™ K å€‹é„°å±…ä¸­ï¼Œé¡åˆ¥ Aï¼ˆè—è‰²ï¼‰å’Œé¡åˆ¥ Bï¼ˆç´…è‰²ï¼‰å„æœ‰å¤šå°‘ç¥¨ã€‚
                    ç¥¨æ•¸è¼ƒå¤šçš„é¡åˆ¥å³ç‚ºé æ¸¬çµæœã€‚
                </div>
                <div class="step-info">
                    <div class="step-info-item">
                        <span class="info-label">é¡åˆ¥ A ç¥¨æ•¸ï¼š</span>
                        <span class="info-value" id="class-a-count-step">0</span>
                    </div>
                    <div class="step-info-item">
                        <span class="info-label">é¡åˆ¥ B ç¥¨æ•¸ï¼š</span>
                        <span class="info-value" id="class-b-count-step">0</span>
                    </div>
                </div>
            </div>
            <div class="step" id="step-8">
                <span class="step-number">8</span>
                <span class="step-title">é¡¯ç¤ºåˆ†é¡çµæœ</span>
                <div class="step-description">
                    å°‡æ¸¬è©¦é»çš„é¡è‰²å¾ç¶ è‰²è®Šç‚ºé æ¸¬é¡åˆ¥çš„é¡è‰²ï¼ˆè—è‰²æˆ–ç´…è‰²ï¼‰ï¼Œ
                    ä¸¦åœ¨è³‡è¨Šé¢æ¿ä¸­é¡¯ç¤ºè©³ç´°çš„åˆ†é¡è³‡è¨Šå’ŒæŠ•ç¥¨çµ±è¨ˆã€‚
                </div>
                <div class="step-info">
                    <div class="step-info-item prediction">
                        <span class="info-label">é æ¸¬åˆ†é¡ï¼š</span>
                        <span class="info-value" id="predicted-class-step" style="color: white;">å°šæœªåˆ†é¡</span>
                    </div>
                </div>
            </div>
            </div>

            <!-- å³å´ï¼šç•«å¸ƒå’Œæ§åˆ¶ -->
            <div class="canvas-section">
                <div class="canvas-container">
                    <canvas id="canvas" width="800" height="600"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3b82f6;"></div>
                            <span>é¡åˆ¥ A (è—è‰²åœ“å½¢)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ef4444; border-radius: 0;"></div>
                            <span>é¡åˆ¥ B (ç´…è‰²æ–¹å½¢)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color star"></div>
                            <span>æ¸¬è©¦é» (æ˜Ÿè™Ÿ)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== è³‡æ–™çµæ§‹ ====================
        let trainingData = [];
        let testPoint = null;
        const classColors = {
            'A': '#3b82f6',  // è—è‰²
            'B': '#ef4444'   // ç´…è‰²
        };

        // ==================== DOM å…ƒç´  ====================
        let canvas;
        let ctx;
        let kSelect;
        let step1;
        let predictedClassDisplayStep;
        let classACountDisplayStep;
        let classBCountDisplayStep;
        let stepDistanceList;
        let stepDistanceItems;
        let downloadDataBtn;

        // ==================== èª¿æ•´ Canvas å¤§å° ====================
        function resizeCanvas() {
            if (!canvas) return;
            
            const container = canvas.parentElement;
            if (!container) return;
            
            const containerWidth = container.clientWidth - 24; // æ¸›å» padding
            const maxWidth = Math.min(800, containerWidth);
            const aspectRatio = 600 / 800;
            
            canvas.style.width = maxWidth + 'px';
            canvas.style.height = (maxWidth * aspectRatio) + 'px';
            
            // é‡æ–°ç¹ªè£½ï¼ˆå¦‚æœå·²ç¶“åˆå§‹åŒ–ï¼‰
            if (trainingData.length > 0) {
                draw();
            }
        }

        // ==================== åˆå§‹åŒ– ====================
        function init() {
            // ç²å– DOM å…ƒç´ 
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            kSelect = document.getElementById('kSelect');
            step1 = document.getElementById('step-1');
            predictedClassDisplayStep = document.getElementById('predicted-class-step');
            classACountDisplayStep = document.getElementById('class-a-count-step');
            classBCountDisplayStep = document.getElementById('class-b-count-step');
            stepDistanceList = document.getElementById('step-distance-list');
            stepDistanceItems = document.getElementById('step-distance-items');
            downloadDataBtn = document.getElementById('downloadDataBtn');

            // æª¢æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
            if (!canvas || !kSelect) {
                console.error('ç„¡æ³•æ‰¾åˆ°å¿…è¦çš„ DOM å…ƒç´ ');
                return;
            }

            // èª¿æ•´ Canvas å¤§å°
            resizeCanvas();
            
            // é˜²æŠ–è™•ç† resize äº‹ä»¶
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    resizeCanvas();
                }, 100);
            });

            // ç”Ÿæˆè¨“ç·´è³‡æ–™
            generateTrainingData();
            draw();
            updateStepHighlight(1);

            // ==================== äº‹ä»¶ç›£è½å™¨ ====================
            // æ­¥é©Ÿ1é»æ“Šäº‹ä»¶ - é‡æ–°ç”Ÿæˆè¨“ç·´è³‡æ–™
            if (step1) {
                step1.addEventListener('click', () => {
                    generateTrainingData();
                    testPoint = null;
                    clearInfo();
                    updateStepHighlight(1);
                    draw();
                });
            }

            // K å€¼ä¸‹æ‹‰é¸å–®
            kSelect.addEventListener('change', (e) => {
                const newK = parseInt(e.target.value);
                if (testPoint) {
                    updateStepHighlight(4);
                    setTimeout(() => {
                        classifyTestPoint();
                        draw();
                    }, 300);
                }
            });

            // ç•«å¸ƒé»æ“Šäº‹ä»¶
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;
                
                testPoint = {
                    x: x,
                    y: y,
                    neighbors: [],
                    predictedClass: null,
                    distances: []
                };
                
                updateStepHighlight(3);
                setTimeout(() => {
                    classifyTestPoint();
                    draw();
                }, 500);
            });

            // ä¸‹è¼‰è¨“ç·´è³‡æ–™æŒ‰éˆ•
            if (downloadDataBtn) {
                downloadDataBtn.addEventListener('click', () => {
                    downloadTrainingDataJSON();
                });
            }
        }

        // ==================== ç”Ÿæˆè¨“ç·´è³‡æ–™ ====================
        function generateTrainingData() {
            trainingData = [];
            const numPoints = 50;
            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;
            
            // ç”Ÿæˆé¡åˆ¥ A çš„é»ï¼ˆè—è‰²åœ“å½¢ï¼‰- å·¦ä¸Šå€åŸŸ
            for (let i = 0; i < numPoints / 2; i++) {
                trainingData.push({
                    x: Math.random() * canvasWidth * 0.4 + canvasWidth * 0.1,
                    y: Math.random() * canvasHeight * 0.4 + canvasHeight * 0.1,
                    class: 'A'
                });
            }
            
            // ç”Ÿæˆé¡åˆ¥ B çš„é»ï¼ˆç´…è‰²æ–¹å½¢ï¼‰- å³ä¸‹å€åŸŸï¼Œç•¥æœ‰é‡ç–Š
            for (let i = 0; i < numPoints / 2; i++) {
                trainingData.push({
                    x: Math.random() * canvasWidth * 0.4 + canvasWidth * 0.4,
                    y: Math.random() * canvasHeight * 0.4 + canvasHeight * 0.4,
                    class: 'B'
                });
            }
        }

        // ==================== åœ¨æ–°åˆ†é é¡¯ç¤ºè¨“ç·´è³‡æ–™ JSON ====================
        function downloadTrainingDataJSON() {
            // ç”Ÿæˆ50ç­†è¨“ç·´è³‡æ–™ç¯„ä¾‹
            const sampleData = [];
            const canvasWidth = 800;
            const canvasHeight = 600;
            
            // ç”Ÿæˆé¡åˆ¥ A çš„é»ï¼ˆ25ç­†ï¼‰
            for (let i = 0; i < 25; i++) {
                const x = Math.random() * canvasWidth * 0.4 + canvasWidth * 0.1;
                const y = Math.random() * canvasHeight * 0.4 + canvasHeight * 0.1;
                sampleData.push({
                    x: Math.round(x * 100) / 100,
                    y: Math.round(y * 100) / 100,
                    label: 'A'
                });
            }
            
            // ç”Ÿæˆé¡åˆ¥ B çš„é»ï¼ˆ25ç­†ï¼‰
            for (let i = 0; i < 25; i++) {
                const x = Math.random() * canvasWidth * 0.4 + canvasWidth * 0.4;
                const y = Math.random() * canvasHeight * 0.4 + canvasHeight * 0.4;
                sampleData.push({
                    x: Math.round(x * 100) / 100,
                    y: Math.round(y * 100) / 100,
                    label: 'B'
                });
            }
            
            // è½‰æ›ç‚º JSON å­—ä¸²ï¼ˆæ ¼å¼åŒ–ï¼‰
            const jsonString = JSON.stringify(sampleData, null, 2);
            
            // è½‰ç¾© JSON å­—ä¸²ä»¥å®‰å…¨åœ°æ’å…¥ HTML
            const escapedJsonString = jsonString
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;');
            
            // æ§‹å»º HTML å…§å®¹ - ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥é¿å…è¯­æ³•é”™è¯¯
            let htmlContent = '<!DOCTYPE html>\n';
            htmlContent += '<html lang="zh-TW">\n';
            htmlContent += '<head>\n';
            htmlContent += '<meta charset="UTF-8">\n';
            htmlContent += '<meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
            htmlContent += '<title>KNN è¨“ç·´è³‡æ–™ç¯„ä¾‹ - JSON</title>\n';
            htmlContent += '<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;min-height:100vh}.container{max-width:1200px;margin:0 auto;background:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.2);overflow:hidden}.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px;text-align:center}.header h1{font-size:2em;margin-bottom:10px}.header p{font-size:1.1em;opacity:0.9}.content{padding:30px}.info-box{background:#f8f9fa;border-left:4px solid #667eea;padding:15px 20px;margin-bottom:20px;border-radius:4px}.info-box p{color:#495057;line-height:1.6}pre{background:#282c34;color:#abb2bf;padding:20px;border-radius:8px;overflow-x:auto;font-family:"Courier New",monospace;font-size:14px;line-height:1.5;box-shadow:0 4px 12px rgba(0,0,0,0.1)}.copy-btn{margin-top:15px;padding:12px 24px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:8px;font-size:1em;font-weight:600;cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(102,126,234,0.3)}.copy-btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(102,126,234,0.4)}.copy-btn:active{transform:translateY(0)}.copy-btn.copied{background:linear-gradient(135deg,#28a745 0%,#20c997 100%)}</style>\n';
            htmlContent += '</head>\n';
            htmlContent += '<body>\n';
            htmlContent += '<div class="container">\n';
            htmlContent += '<div class="header">\n';
            htmlContent += '<h1>KNN è¨“ç·´è³‡æ–™ç¯„ä¾‹</h1>\n';
            htmlContent += '<p>50 ç­†è¨“ç·´è³‡æ–™çš„ JSON æ ¼å¼ç¯„ä¾‹</p>\n';
            htmlContent += '</div>\n';
            htmlContent += '<div class="content">\n';
            htmlContent += '<div class="info-box">\n';
            htmlContent += '<p><strong>èªªæ˜ï¼š</strong>é€™æ˜¯ KNN åˆ†é¡æ¼”ç®—æ³•æ‰€éœ€çš„è¨“ç·´è³‡æ–™æ ¼å¼ã€‚æ¯ç­†è³‡æ–™åŒ…å«å…©å€‹ç‰¹å¾µå€¼ï¼ˆx, yï¼‰å’Œä¸€å€‹é¡åˆ¥æ¨™ç±¤ï¼ˆlabel: A æˆ– Bï¼‰ã€‚</p>\n';
            htmlContent += '</div>\n';
            htmlContent += '<pre id="jsonContent">';
            htmlContent += escapedJsonString;
            htmlContent += '</pre>\n';
            htmlContent += '<button class="copy-btn" onclick="copyToClipboard()">è¤‡è£½ JSON</button>\n';
            htmlContent += '</div>\n';
            htmlContent += '</div>\n';
            htmlContent += '<script>\n';
            htmlContent += 'function copyToClipboard(){\n';
            htmlContent += 'var jsonContent=document.getElementById("jsonContent").textContent;\n';
            htmlContent += 'navigator.clipboard.writeText(jsonContent).then(function(){\n';
            htmlContent += 'var btn=document.querySelector(".copy-btn");\n';
            htmlContent += 'var originalText=btn.textContent;\n';
            htmlContent += 'btn.textContent=\\"å·²è¤‡è£½ï¼\\";\n';
            htmlContent += 'btn.classList.add("copied");\n';
            htmlContent += 'setTimeout(function(){\n';
            htmlContent += 'btn.textContent=originalText;\n';
            htmlContent += 'btn.classList.remove("copied");\n';
            htmlContent += '},2000);\n';
            htmlContent += '});\n';
            htmlContent += '}\n';
            htmlContent += '<\\/script>\\n';
            htmlContent += '</body>\n';
            htmlContent += '</html>';
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
        }

        // ==================== è¨ˆç®—æ­å¹¾é‡Œå¾—è·é›¢ ====================
        function euclideanDistance(p1, p2) {
            const dx = p1.x - p2.x;
            const dy = p1.y - p2.y;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // ==================== KNN åˆ†é¡ ====================
        function classifyTestPoint() {
            if (!testPoint) return;

            updateStepHighlight(4);
            
            const k = parseInt(kSelect.value);
            
            // æ­¥é©Ÿ 4: è¨ˆç®—æ‰€æœ‰è¨“ç·´è³‡æ–™é»åˆ°æ¸¬è©¦é»çš„è·é›¢
            const distances = trainingData.map((point, index) => ({
                point: point,
                distance: euclideanDistance(testPoint, point),
                index: index
            }));
            
            // å„²å­˜æ‰€æœ‰è·é›¢ï¼ˆç”¨æ–¼é¡¯ç¤ºï¼‰
            testPoint.distances = distances.map(d => ({
                ...d,
                formatted: d.distance.toFixed(2)
            }));

            // æ­¥é©Ÿ 5: æŒ‰è·é›¢æ’åºä¸¦é¸å– K å€‹æœ€è¿‘é„°å±…
            distances.sort((a, b) => a.distance - b.distance);
            const actualK = Math.min(k, distances.length);
            testPoint.neighbors = distances.slice(0, actualK);

            updateStepHighlight(5);

            // æ­¥é©Ÿ 7: å¤šæ•¸æŠ•ç¥¨
            const classCounts = { 'A': 0, 'B': 0 };
            testPoint.neighbors.forEach(neighbor => {
                classCounts[neighbor.point.class]++;
            });
            
            // æ±ºå®šé æ¸¬é¡åˆ¥ï¼ˆå¦‚æœå¹³æ‰‹ï¼Œå„ªå…ˆé¸æ“‡é¡åˆ¥Aï¼‰
            testPoint.predictedClass = classCounts['A'] >= classCounts['B'] ? 'A' : 'B';
            testPoint.currentK = actualK;

            updateStepHighlight(7);
            
            // æ›´æ–°è³‡è¨Šé¡¯ç¤º
            updateClassificationInfo();
        }

        // ==================== æ›´æ–°åˆ†é¡è³‡è¨Šé¡¯ç¤º ====================
        function updateClassificationInfo() {
            if (!testPoint) return;
            
            const k = parseInt(kSelect.value);
            const classCounts = { 'A': 0, 'B': 0 };
            
            if (testPoint.neighbors && testPoint.neighbors.length > 0) {
                testPoint.neighbors.forEach(neighbor => {
                    classCounts[neighbor.point.class]++;
                });
            }
            
            // æ›´æ–°æ­¥é©Ÿä¸­çš„é¡¯ç¤º
            if (predictedClassDisplayStep) {
                if (testPoint.predictedClass) {
                    const className = testPoint.predictedClass === 'A' ? 'é¡åˆ¥ A (è—è‰²)' : 'é¡åˆ¥ B (ç´…è‰²)';
                    predictedClassDisplayStep.textContent = className;
                    predictedClassDisplayStep.style.color = 'white';
                } else {
                    predictedClassDisplayStep.textContent = 'å°šæœªåˆ†é¡';
                    predictedClassDisplayStep.style.color = 'white';
                }
            }
            
            if (classACountDisplayStep) classACountDisplayStep.textContent = classCounts['A'];
            if (classBCountDisplayStep) classBCountDisplayStep.textContent = classCounts['B'];
            
            // é¡¯ç¤ºè·é›¢è³‡è¨Šåœ¨æ­¥é©Ÿ4ä¸­
            if (stepDistanceList && stepDistanceItems && testPoint.neighbors && testPoint.neighbors.length > 0) {
                stepDistanceList.style.display = 'block';
                stepDistanceItems.innerHTML = '';
                testPoint.neighbors.forEach((neighbor, idx) => {
                    const item = document.createElement('div');
                    item.className = 'step-distance-item highlight';
                    item.textContent = `${idx + 1}. è·é›¢: ${neighbor.distance.toFixed(2)} - ${neighbor.point.class === 'A' ? 'é¡åˆ¥ A' : 'é¡åˆ¥ B'}`;
                    stepDistanceItems.appendChild(item);
                });
            } else if (stepDistanceList) {
                stepDistanceList.style.display = 'none';
            }
        }

        // ==================== æ¸…é™¤è³‡è¨Š ====================
        function clearInfo() {
            if (predictedClassDisplayStep) {
                predictedClassDisplayStep.textContent = 'å°šæœªåˆ†é¡';
                predictedClassDisplayStep.style.color = 'white';
            }
            if (classACountDisplayStep) classACountDisplayStep.textContent = '0';
            if (classBCountDisplayStep) classBCountDisplayStep.textContent = '0';
            if (stepDistanceList) stepDistanceList.style.display = 'none';
        }

        // ==================== æ›´æ–°æ­¥é©Ÿé«˜äº® ====================
        function updateStepHighlight(activeStep) {
            for (let i = 1; i <= 8; i++) {
                const step = document.getElementById(`step-${i}`);
                if (step) {
                    if (i === activeStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                }
            }
        }

        // ==================== ç¹ªè£½å‡½æ•¸ ====================
        function draw() {
            // æ¸…ç©ºç•«å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç¹ªè£½è¨“ç·´è³‡æ–™é»
            trainingData.forEach(point => {
                ctx.fillStyle = classColors[point.class];
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                
                if (point.class === 'A') {
                    // è—è‰²åœ“å½¢
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                } else {
                    // ç´…è‰²æ–¹å½¢
                    ctx.fillRect(point.x - 8, point.y - 8, 16, 16);
                    ctx.strokeRect(point.x - 8, point.y - 8, 16, 16);
                }
            });
            
            // å¦‚æœæœ‰æ¸¬è©¦é»ï¼Œç¹ªè£½æ¸¬è©¦é»å’Œé€£ç·š
            if (testPoint) {
                // ç¢ºä¿neighborsæ•¸çµ„å·²æ›´æ–°
                if (!testPoint.neighbors || testPoint.neighbors.length === 0) {
                    classifyTestPoint();
                }
                
                // æ­¥é©Ÿ 6: ç¹ªè£½è™›ç·šé€£æ¥åˆ° K å€‹æœ€è¿‘é„°å±…
                if (testPoint.neighbors && testPoint.neighbors.length > 0) {
                    updateStepHighlight(6);
                    
                    ctx.strokeStyle = '#94a3b8';
                    ctx.lineWidth = 1.5;
                    ctx.setLineDash([5, 5]);
                    
                    testPoint.neighbors.forEach(neighbor => {
                        ctx.beginPath();
                        ctx.moveTo(testPoint.x, testPoint.y);
                        ctx.lineTo(neighbor.point.x, neighbor.point.y);
                        ctx.stroke();
                    });
                    
                    ctx.setLineDash([]);
                }
                
                // æ­¥é©Ÿ 8: ç¹ªè£½æ¸¬è©¦é»ï¼ˆæ˜Ÿè™Ÿï¼‰- é¡è‰²æ ¹æ“šé æ¸¬é¡åˆ¥æ±ºå®š
                updateStepHighlight(8);
                
                const fillColor = testPoint.predictedClass ? classColors[testPoint.predictedClass] : '#22c55e';
                ctx.fillStyle = fillColor;
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                
                drawStar(ctx, testPoint.x, testPoint.y, 5, 12, 5);
            }
        }

        // ==================== ç¹ªè£½æ˜Ÿè™Ÿ ====================
        function drawStar(ctx, cx, cy, spikes, outerRadius, innerRadius) {
            let rot = Math.PI / 2 * 3;
            let x = cx;
            let y = cy;
            const step = Math.PI / spikes;

            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);
            
            for (let i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;

                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }
            
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }

        // ==================== å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ ====================
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
